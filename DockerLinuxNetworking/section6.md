# section6: Docker概要

## Dockerの概要とメリット


### Dockerとは

コンテナ型の仮想化技術のこと
コンテナにはゲストOSがないため、VMよりとても軽量

VM
ホストOSの上でVM型仮想用ソフトウェアを動かし、その上でゲストOSを動かす

コンテナ
ホストOSの上でコンテナ型仮想用ソフトウェアを動かし、その上でアプリケーションを動かす

環境構築が簡単

### 仮想マシンによる仮想化

仮想化用ソフトウェアの上でゲストOSが動くため、 CPUやメモリなどのリソース量は多く、起動にかかる時間も長い

### コンテナによる仮想化

ホストOS上にコンテナという環境を作り、まるで独立したOSのように振る舞う
コンテナはゲストOSを必要としないため、リソース量が少なく、起動にかかる時間も短い

### なぜDockerを使うのか

開発・テスト・本番環境の差異をなくすため
環境構築で大きなメリットがあるから

### Dockerがないとどうなるのか

手順書をもとに手作業で環境構築を行う
開発環境と本番環境の差異が生じる

### 環境構築の再現性を高める2つの方法

・Infrastructure as Code
環境構築の内容をコード化する

ex: Chef, Ansible, Terraform

デメリット
実行時に環境によってはエラーが発生する可能性がある
サーバ起動に時間がかかる

・構築した環境をイメージ化

動く環境をイメージ化して運搬

ex: Amazon Machine Image(AMI)

デメリット
イメージのサイズが大きく転送に時間がかかる
VMイメージは作製にかかる時間が長い

・Dockerの登場
VMより軽量な環境をイメージ化して運搬可能で、Infrastructure as Codeのように環境構築の内容をコード化できる

### Dockerの使用例

ex1: 開発用DBの起動

docker run -d -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=password mysql:5.7

ex2: Webアプリの開発環境の起動

docker-compose up -d

## Dockerの仕組みと構成要素

### VMの仮想化の概要

VM方式の仮想化では、ホストOSの中でゲストOSが動作する
ゲストOS内のプロセスは、OSとしては「ゲストOS」で実行される

### コンテナの場合

ゲストOSを起動することなく、ホストOSの機能でプロセスを「コンテナ」という単位で隔離する
コンテナ内のプロセスは、OSとしては「ホストOS」で実行される

### コンテナのファイルシステムの隔離

コンテナは、Linuxのルートディレクトリ以下と同様の構成の「イメージ」をもとに起動する

コンテナ内ではルートディレクトリが変更され、コンテナ内部のファイルしか見えない

### Dockerの構成要素

DockerHubなどのレジストリサーバからDockerイメージをローカルに取得
Dockerイメージからコンテナを起動

dockerコマンドがDockerデーモンに対して指示をする

dockerdがDockerイメージを取得し、コンテナを起動する
dockerdがDockerの本体であり、Dockerエンジンとも呼ばれる
dockerdはdockerデーモンとも呼ばれる

dockerdはDockerコンテナを起動するために、Linuxの機能であるcgroupsやnamespaceを利用する
Linuxの機能を利用するため、DockerはLinux上でしか動作しない
