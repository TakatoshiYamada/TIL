# Section 5: Linuxでの典型的なアプリケーションの環境構築

## Webサーバだけで実現できる「静的サイト」

WebサーバはHTTPリクエストの内容に従って、対応するファイルをHTTPレスポンスに含めて返すだけのシンプルな仕組みです。
Webサーバだけから成り立つ「静的サイト」では、固定のHTML、CSS、JavaScriptだけでサイトを実現することになります

### Webアプリケーションとは

WebサーバがHTTPリクエストを受け取ったとき、リクエストの内容を踏まえてプログラムを実行すれば、プログラムでHTMLやJSONを生成して返すことができます。
このようなWebサーバにプログラムを組み込んだものを「Webアプリケーション」と呼びます。

### Web APIを使ったタスク一覧画面の処理の流れ

1. ブラウザからタスク一覧画面を表示するために、HTTPリクエストを送信する
2. WebサーバがHTMLを返す
3. ブラウザがHTMLを解釈して、JavaScriptをWebサーバから取得する
4. 取得したJavaScriptを実行する
5. 通信が完了したら、JavaScriptがWeb APIを使ってタスク一覧を取得する
6. Webサーバがアプリケーションサーバにタスク一覧を取得するようにリクエストを送信する
7. アプリケーションサーバがDBとやりとりする
8. アプリケーションサーバがrubyを実行しJSONを生成する
9. WebサーバがJSONを返す
10. ブラウザがJSONを解釈して、タスク一覧を表示する

### GPT

Web APIを利用したタスク一覧画面の処理の流れは以下のようになります。

ユーザーのアクション：ユーザーがタスク一覧画面を開くというアクションを行います。これは、ブラウザで特定のURLにアクセスする、またはモバイルアプリで特定の画面を開くといった操作を指します。
フロントエンドのリクエスト：ユーザーのアクションを受けて、フロントエンド（ブラウザやモバイルアプリ）がタスク一覧データを取得するために、バックエンドのWeb APIにHTTPリクエスト（通常はGETリクエスト）を送ります。
バックエンドの処理：Web APIがリクエストを受け取ると、そのリクエストを処理します。これには、データベースへのクエリ実行やビジネスロジックの適用が含まれます。具体的には、データベースからタスクの一覧を取得します。
レスポンスの生成と送信：APIは取得したデータを適切な形式（通常はJSONまたはXML）に変換し、HTTPレスポンスとしてフロントエンドに返します。
フロントエンドのレスポンス処理：フロントエンドはレスポンスを受け取り、データを解析します。そのデータを用いて、タスク一覧画面を更新し、ユーザーに表示します。
ユーザーの反応：最終的に、ユーザーは新しく生成されたタスク一覧画面を見て、次のアクション（タスクの追加、削除、編集など）を選択します。

この流れは、Web APIを利用したタスク一覧画面の基本的な処理フローを示していますが、実際の処理はアプリケーションの種類や設計、要求される機能により異なる可能性があります。

## Nginxのリバースプロキシ

### リバースプロキシの概要

ブラウザからサーバへの通信はNginxが受け取る
URLのパスが/api/から始まる場合だけ、処理をSinatraに依頼したい
このように、本当に処理を依頼したいサーバの手前に挟まるサーバを「リバースプロキシ」と呼びます。

Nginxがリバースプロキシになることで、SinatraにはURLのパスが/api/から始まるリクエストだけが届くようになります。

設定ファイルを変更することで、一部のファイルのアクセスを別に動かせる

### GPTでのリバースプロキシ

リバースプロキシ（Reverse Proxy）は、クライアントからの要求をバックエンドのサーバーに転送し、そのサーバーからのレスポンスをクライアントに返す役割を果たすサーバーのことです。
リバースプロキシは以下のような機能を提供します：

負荷分散（ロードバランシング）：クライアントからの要求を複数のサーバーに分散し、サーバーの負荷を均等にすることができます。
キャッシング：頻繁に要求されるコンテンツを一時的に保存して、サーバーへのアクセスを減らすことができます。
SSL/TLSの終端：SSL/TLSでの暗号化と復号化の処理をリバースプロキシで行い、バックエンドサーバーの処理負荷を軽減することができます。
セキュリティ：リバースプロキシはクライアントとバックエンドサーバーとの間に位置するため、不正なアクセスを防ぐ、あるいは特定の要求をフィルタリングするなどのセキュリティ対策を提供することができます。

これらの特性から、リバースプロキシはウェブサーバーやAPIサーバーの前に配置して、パフォーマンスの向上やセキュリティの強化を図る目的でよく使われます。

## フロントエンドエンドとバックエンドの疎通

async/awaitを使うことで、非同期処理を同期処理のように書くことができる

```js
async function main(){
        const response = await fetch('/api/hello')
        console.log(response)
        const responseBody = await response.json()
        console.log(responseBody)

        const messageElement = document.getElementById('message')
        messageElement.innerText = responseBody.message
}
main()
```

## メモ

JavaScriptはブラウザで動く
Rubyはサーバーで動く

JavaScriptはサーバ上においてあるが、ブラウザが取得して実行する
JavaScriptはブラウザ上で動く

fetchの関数でNginxにリクエストを送る
Nginxはリバースプロキシとして動作している
/api/から始まるリクエストはSinatraに転送される

Sinatraはconnectという箇所でDBに接続している

### build-essential

build-essentialは、Rubyとは直接関係のない、Linuxディストリビューション（主にDebianベースのもの）で利用されるパッケージです。このパッケージは、ソフトウェアをソースコードからビルドする際に必要なツール群を含んでいます。

build-essentialパッケージには以下のようなツールが含まれます：

gcc：GNU C コンパイラ。C言語のソースコードをコンパイルするために使用します。

g++：GNU C++ コンパイラ。C++言語のソースコードをコンパイルするために使用します。

make：Makefileを解析し、指定されたターゲットのビルドを行うツール。

dpkg-dev：Debianパッケージを作成するためのツール群。

Ruby自体をソースコードからビルドしたり、Rubyの一部のgem（C言語で書かれているものなど）をインストールする際には、これらのツールが必要になることがあります。そのため、Rubyの環境をセットアップする際にbuild-essentialパッケージのインストールが推奨されることがあります。
