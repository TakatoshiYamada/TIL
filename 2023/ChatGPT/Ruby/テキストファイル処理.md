# テキストファイル処理

rubyでtxtデータを読み込み、一行ずつ処理したい

Rubyでテキストデータを読み込み、一行ずつ処理する場合、Fileクラスを使ってファイルを開き、each_lineメソッドを使用して一行ずつ読み込んで処理することができます。以下に基本的な例を示します。

```ruby
# ファイルパス
file_path = 'example.txt'

# ファイルを開き、一行ずつ読み込む
File.open(file_path, 'r') do |file|
  file.each_line do |line|
    # ここで各行に対しての処理を行う
    puts line
  end
end
```

このコードでは、example.txtという名前のファイルを読み込み、その内容を一行ずつコンソールに出力します。File.openの第一引数にはファイルのパスを、第二引数にはファイルモードを指定します（この場合は読み込みモードの'r'）。

この方法を使えば、ファイルから読み込んだ各行に対して任意の処理を行うことができます。たとえば、特定の文字で始まる行だけを処理したい場合や、行を加工して新しいファイルに書き出したい場合など、さまざまなシナリオに対応することが可能です。

## File.openで1行ずつ読み込んでたけど、1行の中に更に半角スペース区切りになってて、それも1レコードで扱う仕様だった。何とかなるかな

はい、その仕様に合わせてファイルから行を読み込んだ後、各行を半角スペースで区切って複数のレコードとして扱うことができます。RubyのStringクラスのsplitメソッドを使用すると、指定した区切り文字に基づいて文字列を分割し、配列として取得することが可能です。以下に、半角スペースで区切られたデータを読み込んで、それぞれのレコードを個別に扱う方法の例を示します。

```ruby
# ファイルパス
file_path = 'example.txt'

# ファイルを開き、一行ずつ読み込む
File.open(file_path, 'r') do |file|
  file.each_line do |line|
    # chompメソッドで行末の改行を削除
    line = line.chomp

    # 半角スペースで行を分割し、個々のレコードとして扱う
    records = line.split(' ')

    # 分割されたレコードに対する処理
    records.each do |record|
      # ここで各レコードに対する処理を行う
      puts record
    end
  end
end
```

このコードでは、each_lineメソッドを使ってファイルから行を読み込み、chompメソッドで行末の改行を削除した後、split(' ')メソッドを使用して行を半角スペースで分割しています。その結果得られたrecords配列には、その行に含まれる個々のレコードが要素として格納されます。その後、records配列をループして、各レコードに対して必要な処理を行います。

この方法を用いることで、1行に含まれる複数のレコードを個別に処理することが可能になります。これは、スペース区切りのログファイルを解析する場合や、単純なテキストベースのデータベースを扱う場合など、さまざまなシナリオで役立ちます。

## 他バリエーション

```ruby

      # chompメソッドで行末の改行を削除
      line = line.chomp

      # 行が数字とハイフン以外を含む場合は例外を発生させる
      unless line.match?(/\A[\d-]+\z/)
        raise "Line contains characters other than digits and hyphens"
      end
```
