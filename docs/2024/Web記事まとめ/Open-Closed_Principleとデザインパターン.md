# Open-Closed Principleとデザインパターン.md

## そもそもソフトウェアにおけるデザインパターンって何？


ソフトウェアにおけるデザインパターンとは、ソフトウェア開発において一般的に直面する問題を解決するための再利用可能なソリューションのことです。
これらのパターンは、特定の設計問題に対するベストプラクティスとして認識されており、効率的かつ効果的な方法でソフトウェア設計の課題に対処するために用いられます。

デザインパターンは1990年代初頭に「Design Patterns: Elements of Reusable Object-Oriented Software」という書籍で初めて広く紹介されました。
この本は、エーリック・ガンマ、リチャード・ヘルム、ラルフ・ジョンソン、ジョン・ブリシディース（ギャング・オブ・フォー、GOFとして知られています）によって書かれ、22のデザインパターンが紹介されています。

デザインパターンは大きく三つのカテゴリーに分けられます：

1. 生成に関するパターン（Creational Patterns） - オブジェクトの作成に関連する問題を解決します。例えば、SingletonやBuilder、Factory Methodなどがあります。
2. 構造に関するパターン（Structural Patterns） - オブジェクトとクラスの構成を整理する方法を提供します。例えば、Adapter、Decorator、Facadeなどがあります。
3. 振る舞いに関するパターン（Behavioral Patterns） - オブジェクト間の通信を効果的に行う方法を提供します。例えば、Observer、Strategy、Commandなどがあります。

これらのパターンを使用することで、ソフトウェア開発者はよりクリーンで管理しやすいコードを書くことができ、複雑な問題に対して標準的なアプローチを適用することが可能になります。
また、デザインパターンは、開発者間のコミュニケーションを促進するための共通の言語としても機能します。

## 優れたソフトウェア

まず、ソフトウェアの仕様変更とそれにかかるコストという観点から考えます。
コストの観点から見て優れたソフトウェアとは、仕様の変更とソフトウェアに対する修正が対応しているものだといえるでしょう。
つまり、仕様の変更が小さければソフトウェアの修正も小さく、大きければ修正も大きくなる自然なソフトウェアです。
しかし、ソフトウェアによっては、少しの修正に対して大幅な修正を引き起こしてしまう場合もあります。
こうした状況を「仕様変更に対してそのコストが連続していない（不連続）」といいます。
言うまでもなく、コスト的に優れたソフトウェアとは仕様変更に対して連続性を持つことを意味します。

つまり「ソフトウェアがさまざまな仕様変更でどういう修正が加わるのかを常に考える」ことが、優れたソフトウェアをつくるための第一歩なのです。

## Open-Closed Principle

「モジュールは拡張に対して開いて (Open) おり、修正に対して閉じて (Closed) いなければならない」

## オブジェクト指向と OCP

1. 変更の可能性のあるところ（ホットスポット）を見つける。
2. その部分を抽象化してクラスにしてしまう。
3. 抽象クラスのサブクラスで変化に対応する。

## デザインパターンと OCP

1. 古いパターン
2. 何度も使われているパターン
3. シンプルなパターン

## デザインパターンの例： Iterator

オブジェクト指向モデルは、複数のオブジェクトが互いにメッセージを送って協調しあうものですが、これを素直にうけとめてモデル化すると、あちこちで処理が分散し、結果的に分かりにくくメンテナンスしにくいモデルになってしまいます。
つまり各オブジェクトが他のオブジェクトと密接に関連しあう複雑なモデルになってしまうわけです。これではそもそも何のためにクラスやオブジェクトに分けたのか、わからなくなってしまいます。

1. 変更の可能性があるのはどこか？ 柔軟性を持たせなければならないところはどこか？

例えば、柔軟性を持たせなければならないのがアルゴリズムなら Strategy のパターン、オブジェクトの状態ならば State のパターンなどを検討してみます。

2. そのパターンを使うことで柔軟性を失うのはどこか？
例えば、 AbstractFactory パターンを使うと、生成するオブジェクトの集合を変えることが可能ですが、その集合に新しい種類のオブジェクトを追加するにはかなりの修正が必要です。つまりこのパターンは、オブジェクトの種類を変更することについて OCP を満たしていないことが分かります。

「 OCP が最も効果的に成り立つようにデザインパターンを使う 」 ことが重要です。個々のデザインパターンには長所と短所の両方あり、そのトレードオフを見極めて使わなければなりません。

自分が好きなパターンだからといって何度も同じパターンを使うのは単なるワンパターンに過ぎません。
また、 1つのシステムにより多くのデザインパターンを適用することが良いことでもありません。
こういった意味で、デザインパターンは従来のアルゴリズムとデータ構造に似ているでしょう。アルゴリズムとデータ構造にはそれぞれ長所と短所があります。
例えば、あるアルゴリズムは高速に処理できるがその分メモリをたくさん消費する。
また、別のデータ構造を使うと検索は速いが更新は遅いということがあります。
これと同様に、すべての局面で優れた設計を提供するようなパターンはありません。
どういう状況で、何を目的にして使うのか判断することが重要で、逆にそうしたことを念頭においてデザインパターンを習得する必要があるでしょう。

## Open-Closed Principleって何？

Open-Closed Principle（オープン/クローズドの原則）は、ソフトウェアエンジニアリングの原則の一つで、SOLID原則として知られる5つの設計原則の一つです。この原則は、Bertrand Meyerによって1988年に提唱されました。Open-Closed Principleは次のように定義されます：

「ソフトウェアのエンティティ（クラス、モジュール、関数など）は拡張に対して開かれているべきであり、変更に対して閉じているべきである。」

具体的には、この原則に従うことで、既存のコードを変更せずにシステムの機能を拡張することができます。つまり、新しい機能を追加する際には既存のコードを変更するのではなく、既存のコードを拡張（例えば、サブクラス化やプラグインのようなメカニズムを使用して）することで対応することを意味します。

例えば、あるソフトウェアシステムで支払い処理を行うクラスがあり、現在はクレジットカードのみをサポートしているとします。将来的にPayPalや銀行振込をサポートしたい場合、Open-Closed Principleに従って、既存のクラスを変更するのではなく、新しい支払い方法を処理するクラスを追加する形でシステムを拡張します。

この原則は、ソフトウェアが成長し続ける中で、既存のコードを安全に維持しつつ新しい機能を簡単に追加できるようにするために重要です。また、システムの柔軟性、再利用性、保守性を高める効果があります。