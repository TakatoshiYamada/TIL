# @bannerをsaveしたらidに0が振られた。どういうことやら

Note: オブジェクトをnewしたときにidが0に振られた

@bannerをsaveした際にidに0が振られるという現象は、通常のRailsやActiveRecordの動作としては期待されるものではありません。以下の要因が考えられます：

カスタムのセットアップ：モデルや関連するコードに、idの振る舞いを変更するカスタムのロジックが存在するか確認してください。

データベースの設定：使用しているデータベースのテーブルの設定や、データベース自体の設定で、IDの生成やデフォルト値に何らかのカスタム設定が行われている可能性が考えられます。

ジェムの影響：使用しているジェムの中には、ActiveRecordの動作を変更するものがあります。特に、モデルのIDや属性に関連するジェムがこのような動作を引き起こしている可能性があります。

Railsのバージョンや設定：特定のRailsのバージョンや設定が、このような動作の原因となっている可能性も考慮する必要があります。

データベースの状態：何らかの理由でデータベースの自動インクリメント機能が正常に動作していない、またはリセットされている可能性も考えられます。

対策として、以下のステップを試してみてください：

モデルの再確認：Bannerモデルのコードを再確認し、カスタムの動作を行っている部分がないか確認してください。

データベースの設定確認：データベースのbannersテーブルの設定を確認し、idカラムに関する設定がデフォルトから変更されていないか確認してください。

データベースの再起動：データベースサーバーを再起動して、問題が解決するか確認してください。

新しいレコードの追加：新しいレコードを追加してみて、同じ問題が再現されるか確認してください。

ログの確認：Railsのログやデータベースのログを確認し、異常やエラーが記録されていないか確認してください。

これらのステップを試してみることで、問題の原因を特定する手助けとなるはずです。

## テーブル作成時のSQLにnot null default 0ってあるんだけど、これが原因ってありうる？

はい、そのSQLの定義が原因である可能性が非常に高いです。

not null default 0という定義は、カラムがNULLを許容しないことを意味し、新しいレコードが挿入される際に明示的に値が設定されない場合はデフォルトで0を設定することを示します。

ActiveRecordがレコードを新しく作成する際、IDカラムの値が明示的に設定されていないと、データベースのデフォルト値（この場合は0）が使用されます。これがIDに0が設定される原因となっています。

この問題を解決するためには、IDカラムのデフォルト値を0からNULL（もしくは、自動インクリメント属性が有効になっている場合はその設定）に変更する必要があります。

Railsのマイグレーションを使用してこの変更を行う場合、以下のようなマイグレーションを生成・適用します：

```ruby
class ChangeIdDefaultOnBanners < ActiveRecord::Migration[6.0] # 適切なバージョンに変更してください
  def change
    change_column_default :banners, :id, nil
  end
end
```

## 結果的にこうなった

```sql
CREATE TABLE `banners` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  ...
  PRIMARY KEY (`id`)
);
```

## プライマリキーがないとエラー

エラーメッセージ「Incorrect table definition; there can be only one auto column and it must be defined as a key」によれば、テーブルの定義において次のいずれかの問題が発生していることを示しています：

テーブル内にAUTO_INCREMENT属性が2つ以上のカラムに設定されている。
AUTO_INCREMENT属性が設定されているカラムがプライマリキーまたはユニークキーとして定義されていない。
画像の内容を確認すると、banners テーブルの id カラムに AUTO_INCREMENT が設定されていますが、このカラムがプライマリキーとして定義されていないように見えます。

解決方法として、id カラムをプライマリキーとして定義する必要があります。
